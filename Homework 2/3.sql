-- Exercise 3

-- Order countries by INDEPYEAR and show the top 20 countries
-- Show the country's life expectancy, calculate the continental average, and show the differences
-- Final Result: Order by INDEPYEAR

SELECT
   NAME,
   CONTINENT,
   INDEPYEAR,
   LIFEEXPECTANCY,
   AVG(LIFEEXPECTANCY) OVER (PARTITION BY CONTINENT) AS AVG_CONTINENT,
   LIFEEXPECTANCY - AVG(LIFEEXPECTANCY) OVER (PARTITION BY CONTINENT) AS LIFE_DIFF
FROM
   COUNTRY
ORDER BY
   INDEPYEAR
LIMIT
   20;

/*
name;continent;indepyear;lifeexpectancy;avg_continent;life_diff
"China";"Asia";-1523;71.4;67.4411767697802;3.95882475609874
"Ethiopia";"Africa";-1000;45.2;52.5719296639426;-7.37192890100312
"Japan";"Asia";-660;80.7;67.4411767697802;13.258820178462
"Denmark";"Europe";800;76.5;75.1477276195179;1.35227238048206
"Sweden";"Europe";836;79.6;75.1477276195179;4.45227085460316
"France";"Europe";843;78.8;75.1477276195179;3.65227543223988
"San Marino";"Europe";885;81.1;75.1477276195179;5.95227085460316
"United Kingdom";"Europe";1066;77.7;75.1477276195179;2.55226932872425
"Portugal";"Europe";1143;75.8;75.1477276195179;0.652275432239875
"Andorra";"Europe";1278;83.5;75.1477276195179;8.35227238048206
"Thailand";"Asia";1350;68.6;67.4411767697802;1.15882170434092
"Spain";"Europe";1492;78.8;75.1477276195179;3.65227543223988
"Switzerland";"Europe";1499;79.6;75.1477276195179;4.45227085460316
"Netherlands";"Europe";1581;78.3;75.1477276195179;3.15227543223988
"Nepal";"Asia";1769;57.8;67.4411767697802;-9.64117753271962
"United States";"North America";1776;77.1;72.991891706312;4.10810676780906
"Haiti";"North America";1804;49.2;72.991891706312;-23.7918909433726
"Liechtenstein";"Europe";1806;78.8;75.1477276195179;3.65227543223988
"Chile";"South America";1810;75.7;70.9461532005897;4.7538437476525
"Mexico";"North America";1810;71.5;72.991891706312;-1.49189170631203
*/